<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ë°¸ëŸ°ìŠ¤ ê²Œì„ - ì£¼ì œë³„ ëª¨ìŒ</title>
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-square.css" rel="stylesheet">
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ (ì´ì „ê³¼ ë™ì¼) */
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: 'NanumSquare', sans-serif;
            margin: 0; padding: 0;
            text-align: center;
        }
        header {
            padding: 30px 20px;
            background: linear-gradient(135deg, #ff0055, #0055ff);
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
            position: relative;
        }
        h1 { margin: 0; font-size: 1.8rem; font-weight: 800; font-style: italic; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); cursor: pointer;}
        p.subtitle { margin-top: 8px; font-size: 1rem; opacity: 0.9; }

        .container { max-width: 600px; margin: 0 auto; padding: 0 15px; }

        /* --- [NEW] í™ˆ í™”ë©´: ê²Œì„ ëª©ë¡ ì¹´ë“œ ìŠ¤íƒ€ì¼ --- */
        .topic-card {
            background-color: #1e1e1e;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .topic-card:hover {
            transform: translateY(-3px);
            border-color: #0055ff;
            background-color: #252525;
        }
        .topic-info { text-align: left; }
        .topic-date { font-size: 0.85rem; color: #888; margin-bottom: 5px; font-weight: bold;}
        .topic-title { font-size: 1.2rem; font-weight: bold; color: white; }
        .topic-desc { font-size: 0.9rem; color: #bbb; margin-top: 5px;}
        .topic-icon { font-size: 2rem; margin-left: 15px; }
        
        /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */
        .back-btn {
            display: none; /* ê²Œì„ í™”ë©´ì—ì„œë§Œ ë³´ì„ */
            position: absolute;
            left: 20px; top: 30px;
            background: rgba(0,0,0,0.3);
            border: none; color: white; font-size: 1.5rem; cursor: pointer;
            border-radius: 50%; width: 40px; height: 40px;
        }

        /* ê¸°ì¡´ ê²Œì„ ì¹´ë“œ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        .game-card {
            background-color: #1e1e1e;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 40px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            border: 1px solid #333;
        }
        .question-title { font-size: 1.3rem; font-weight: bold; margin-bottom: 20px; color: #fff; text-align: left; border-left: 4px solid #ff0055; padding-left: 10px;}
        .vs-container { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 20px; }
        .option-box {
            flex: 1; background-color: #2c2c2c; border-radius: 12px;
            overflow: hidden; position: relative; cursor: pointer;
        }
        .option-img {
            width: 100%; height: 160px; object-fit: cover;
            background-color: #333; display: flex; align-items: center; justify-content: center; font-size: 3rem;
        }
        .option-label { padding: 15px 5px; font-size: 0.95rem; font-weight: bold; line-height: 1.4; color: #ddd;}
        .btn-group { display: flex; gap: 10px; }
        .vote-btn {
            flex: 1; padding: 15px; border: none; border-radius: 10px;
            font-weight: bold; font-size: 1rem; cursor: pointer; transition: 0.2s;
            color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .btn-a { background: #ff0055; }
        .btn-b { background: #0055ff; }
        .vote-btn:disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(100%); }
        .result-bar-container {
            margin-top: 20px; background-color: #333; border-radius: 50px;
            height: 30px; overflow: hidden; position: relative; display: none;
        }
        .bar-fill-a { background-color: #ff0055; height: 100%; width: 50%; float: left; transition: width 0.8s ease-out; }
        .bar-text {
            position: absolute; width: 100%; height: 100%; display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; box-sizing: border-box; font-size: 0.85rem; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        .loading { color: #888; margin-top: 10px; display: none; }

        /* í™”ë©´ ì „í™˜ìš© ìœ í‹¸ë¦¬í‹° */
        .hidden { display: none !important; }
        
        footer { margin-top: 60px; padding-bottom: 40px; color: #666; font-size: 0.8rem; }
        .cta-box { background: #222; padding: 20px; border-radius: 10px; margin-top: 20px; }
        .cta-btn { background: white; color: black; padding: 10px 20px; border-radius: 20px; text-decoration: none; font-weight: bold; display: inline-block; margin-top: 10px;}
    </style>
</head>
<body>

    <header>
        <button class="back-btn" id="back-btn" onclick="goHome()">â—€</button>
        <h1 onclick="goHome()">âš–ï¸ ë°¸ëŸ°ìŠ¤ ê²Œì„ ì²œêµ­</h1>
        <p class="subtitle">ì˜¤ëŠ˜ì˜ ë‚œì œë“¤ì„ í•´ê²°í•´ì£¼ì„¸ìš”!</p>
    </header>

    <div class="container" id="home-screen">
        </div>

    <div class="container hidden" id="game-screen">
        <div id="questions-area">
            </div>
        
        <div class="cta-box">
            <h3>ì¬ë°Œìœ¼ì…¨ë‚˜ìš”?</h3>
            <p>ë§¤ì¼ ìƒˆë¡œìš´ ì£¼ì œê°€ ì˜¬ë¼ì˜µë‹ˆë‹¤!</p>
            <a href="https://www.youtube.com/@ingongzineong" class="cta-btn">ìœ íŠœë¸Œ êµ¬ë…í•˜ê¸° â–¶</a>
        </div>
    </div>

    <footer>
        <p>Â© 2024 AI Balance Game Project.</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, updateDoc, increment, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDOVsnq_Hwkwq0UXUhrO1QB50_idyz5-Z8",
            authDomain: "webweb-a0c33.firebaseapp.com",
            projectId: "webweb-a0c33",
            storageBucket: "webweb-a0c33.firebasestorage.app",
            messagingSenderId: "632200171644",
            appId: "1:632200171644:web:614f78c7c9ec8669c0f9f9",
            measurementId: "G-N3G610NRDE"
        };

        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
        } catch (e) {
            console.log("Firebase ë¡œì»¬ ëª¨ë“œ");
        }

        // -----------------------------------------------------------
        // 1. ë°ì´í„° êµ¬ì¡° ë³€ê²½: 'ì£¼ì œ(Topic)'ë³„ë¡œ ë¬¸ì œë“¤ì„ ë¬¶ì—ˆìŠµë‹ˆë‹¤.
        // -----------------------------------------------------------
        const gameData = [
            {
                id: "topic1",
                date: "11ì›” 25ì¼",
                title: "ğŸ”¥ ì»¤í”Œ ë…¼ìŸ íŠ¹ì§‘",
                desc: "ê¹»ì ë…¼ìŸë³´ë‹¤ ë” ì‹¬ê°í•œ ë¬¸ì œë“¤",
                icon: "ğŸ’”",
                questions: [
                    { id: "q1", title: "Q1. ë” ì‹«ì€ ì—°ì•  ìŠ¤íƒ€ì¼ì€?", a: "ì‹¸ìš¸ ë•Œë§ˆë‹¤ ì˜¤ì—´", b: "ì‹¸ìš°ë©´ ì—°ë½ë‘ì ˆ", imgA: "ğŸ˜­", imgB: "ğŸ¤" },
                    { id: "q6", title: "Q2. ë” ì‹«ì€ ì—°ì•  ì„ ë¬¼ì€?", a: "ë‹¹ê·¼ì—ì„œ êµ¬ë§¤í•œ ì„ ë¬¼", b: "ë‚¨ì´ ì¤€ ì„ ë¬¼", imgA: "ğŸ›ï¸", imgB: "ğŸ’" }
                ]
            },
            {
                id: "topic2",
                date: "11ì›” 24ì¼",
                title: "ğŸ• ìŒì‹ ë°¸ëŸ°ìŠ¤ ê²Œì„",
                desc: "ìŒì‹ê³¼ ê´€ë ¨í•œ ë°¸ëŸ°ìŠ¤ ê²Œì„",
                icon: "ğŸ”",
                questions: [
                    { id: "q2", title: "Q1. ìµœì•…ì˜ ì‹ì‚¬ëŠ”?", a: "ì–‘ë… ì—†ëŠ” ë–¡ë³¶ì´", b: "êµ­ë¬¼ ì—†ëŠ” êµ­ìˆ˜", imgA: "ğŸŒ¶ï¸", imgB: "ğŸœ" },
                    { id: "q5", title: "Q2. í‰ìƒ í•˜ë‚˜ë§Œ ë¨¹ëŠ”ë‹¤ë©´?", a: "ë¼ë©´", b: "í–„ë²„ê±°", imgA: "ğŸ”", imgB: "ğŸœ" }
                ]
            },
            {
                id: "topic3",
                date: "11ì›” 23ì¼",
                title: "ğŸ‘» ë‹¤ì‹œ íƒœì–´ë‚œë‹¤ë©´?",
                desc: "ë§Œì•½ ë‚´ê°€ ë‹¤ì‹œ íƒœì–´ë‚œë‹¤ë©´...",
                icon: "âœ¨",
                questions: [
                    { id: "q3", title: "Q1. ë‹¤ì‹œ íƒœì–´ë‚¬ì„ ë•Œ, ë‚˜ì˜ ì‹ ì²´ëŠ”?", a: "ë§¤ìš° ë§ˆë¦„", b: "ë§¤ìš° ëš±ëš±", imgA: "ğŸ’€", imgB: "ğŸ«ƒ" },
                    { id: "q4", title: "Q2. ë‹¤ì‹œ íƒœì–´ë‚  ì‚¶ì€?", a: "ê±°ì§€ ì°¨ì€ìš°", b: "10ì–µ ê°€ì§€ê³  ìˆëŠ” í˜„ì¬ì˜ ë‚˜", imgA: "ğŸ˜", imgB: "ğŸ‘¨" }
                ]
            }
        ];

        const homeScreen = document.getElementById('home-screen');
        const gameScreen = document.getElementById('game-screen');
        const questionsArea = document.getElementById('questions-area');
        const backBtn = document.getElementById('back-btn');

        // -----------------------------------------------------------
        // 2. í™ˆ í™”ë©´ ë Œë”ë§ (ëª©ë¡ ë§Œë“¤ê¸°)
        // -----------------------------------------------------------
        function renderHome() {
            homeScreen.innerHTML = ""; // ì´ˆê¸°í™”
            gameData.forEach(topic => {
                const html = `
                    <div class="topic-card" onclick="openGame('${topic.id}')">
                        <div class="topic-info">
                            <div class="topic-date">${topic.date}</div>
                            <div class="topic-title">${topic.title}</div>
                            <div class="topic-desc">${topic.desc}</div>
                        </div>
                        <div class="topic-icon">${topic.icon}</div>
                    </div>
                `;
                homeScreen.innerHTML += html;
            });
        }

        // -----------------------------------------------------------
        // 3. ê²Œì„ í™”ë©´ ì§„ì… ë° ë Œë”ë§
        // -----------------------------------------------------------
        window.openGame = (topicId) => {
            // í•´ë‹¹ í† í”½ ë°ì´í„° ì°¾ê¸°
            const topic = gameData.find(t => t.id === topicId);
            if (!topic) return;

            // í™”ë©´ ì „í™˜ (í™ˆ ìˆ¨ê¸°ê¸°, ê²Œì„ ë³´ì´ê¸°)
            homeScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            backBtn.style.display = "block"; // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ë³´ì´ê¸°

            // ë¬¸ì œ ë Œë”ë§
            questionsArea.innerHTML = `<h2 style="margin-bottom:30px; color:#0055ff;">${topic.title}</h2>`;
            
            topic.questions.forEach(q => {
                const html = `
                    <div class="game-card" id="${q.id}">
                        <div class="question-title">${q.title}</div>
                        <div class="vs-container">
                            <div class="option-box" onclick="handleVote('${q.id}', 'A')">
                                <div class="option-img">${q.imgA}</div>
                                <div class="option-label">${q.a}</div>
                            </div>
                            <div class="option-box" onclick="handleVote('${q.id}', 'B')">
                                <div class="option-img">${q.imgB}</div>
                                <div class="option-label">${q.b}</div>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button class="vote-btn btn-a" id="btn-a-${q.id}" onclick="handleVote('${q.id}', 'A')">A ì„ íƒ</button>
                            <button class="vote-btn btn-b" id="btn-b-${q.id}" onclick="handleVote('${q.id}', 'B')">B ì„ íƒ</button>
                        </div>
                        <div class="loading" id="load-${q.id}">íˆ¬í‘œ ë°˜ì˜ ì¤‘...</div>
                        <div class="result-bar-container" id="result-${q.id}">
                            <div class="bar-fill-a" id="bar-${q.id}"></div>
                            <div class="bar-text">
                                <span id="text-a-${q.id}">A: 0%</span>
                                <span id="text-b-${q.id}">B: 0%</span>
                            </div>
                        </div>
                    </div>
                `;
                questionsArea.innerHTML += html;
            });

            // ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤
            window.scrollTo(0, 0);
        };

        // -----------------------------------------------------------
        // 4. ë’¤ë¡œ ê°€ê¸° (í™ˆìœ¼ë¡œ)
        // -----------------------------------------------------------
        window.goHome = () => {
            gameScreen.classList.add('hidden');
            homeScreen.classList.remove('hidden');
            backBtn.style.display = "none";
            window.scrollTo(0, 0);
        };

        // ì´ˆê¸° ì‹¤í–‰
        renderHome();

        // -----------------------------------------------------------
        // 5. íˆ¬í‘œ ë¡œì§ (ê¸°ì¡´ê³¼ ë™ì¼)
        // -----------------------------------------------------------
        window.handleVote = async (qId, choice) => {
            const btnA = document.getElementById(`btn-a-${qId}`);
            const btnB = document.getElementById(`btn-b-${qId}`);
            if(btnA.disabled) return; // ì´ë¯¸ íˆ¬í‘œí–ˆìœ¼ë©´ ì¤‘ë³µ ë°©ì§€

            btnA.disabled = true;
            btnB.disabled = true;
            document.getElementById(`load-${qId}`).style.display = "block";

            if (db) {
                const docRef = doc(db, "polls", qId);
                try {
                    const docSnap = await getDoc(docRef);
                    if (!docSnap.exists()) {
                        await setDoc(docRef, { A: 10, B: 10 });
                    }
                    await updateDoc(docRef, { [choice]: increment(1) });
                    const updatedSnap = await getDoc(docRef);
                    const data = updatedSnap.data();
                    showResult(qId, data.A, data.B);
                } catch (error) {
                    console.error("Error:", error);
                    alert("ì˜¤ë¥˜ ë°œìƒ");
                }
            } else {
                // ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© ê°€ì§œ ê²°ê³¼
                setTimeout(() => {
                    const fakeA = Math.floor(Math.random() * 500) + 50;
                    const fakeB = Math.floor(Math.random() * 500) + 50;
                    showResult(qId, fakeA + (choice==='A'?1:0), fakeB + (choice==='B'?1:0));
                }, 500);
            }
        };

        function showResult(qId, countA, countB) {
            document.getElementById(`load-${qId}`).style.display = "none";
            document.getElementById(`result-${qId}`).style.display = "block";
            
            const total = countA + countB;
            const percentA = Math.round((countA / total) * 100);
            const percentB = 100 - percentA;

            document.getElementById(`bar-${qId}`).style.width = percentA + "%";
            document.getElementById(`text-a-${qId}`).innerText = `A: ${percentA}% (${countA}í‘œ)`;
            document.getElementById(`text-b-${qId}`).innerText = `B: ${percentB}% (${countB}í‘œ)`;
        }

    </script>
</body>
</html>